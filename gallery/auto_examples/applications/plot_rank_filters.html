


<!DOCTYPE html>
<html lang="en">
<head>
        <title>Rank filters &mdash; skimage v0.11dev docs</title>
    
    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link href="../../_static/css/bootstrap.min.css" rel="stylesheet" type="text/css">
    <link href="../../_static/css/custom.css" rel="stylesheet" type="text/css">
    <link href="../../_static/css/interactive.css" rel="stylesheet" type="text/css">
    <link href="http://fonts.googleapis.com/css?family=Raleway" rel="stylesheet" type="text/css">
    
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="../../_static/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/interactive.js"></script>
    <script type="text/javascript" src="http://cdn.jsdelivr.net/ace/1.1.3/min/ace.js"></script>
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.11dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <link rel="top" title="skimage v0.11dev docs" href="../../index.html" />
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <link rel="shortcut icon" href="../../_static/favicon.ico">
</head>
<body class="container">
    <a href="http://scikit-image.org" class="logo"><img src="../../_static/img/logo.png" alt=""></a>
    <div class="clearfix"></div>
    <div class="navbar">
        <div class="navbar-inner">
            <ul class="nav">
                <li><a href="/">Home</a></li>
<li><a href="/download.html">Download</a></li>
<li><a href="/docs/dev/auto_examples">Gallery</a></li>
<li><a href="/docs/dev">Documentation</a></li>
<li><a href="https://github.com/scikit-image/scikit-image">Source</a></li>
            </ul>
            <form class="navbar-form pull-right" action="../../search.html" method="get">
                <input type="text" class="search span3" name="q" placeholder="Search documentation ...">
                <input type="hidden" name="check_keywords" value="yes" >
                <input type="hidden" name="area" value="default" >
            </form>
        </div>
    </div>
    <div class="row">
        <div class="span9">
            
  <div class="section" id="rank-filters">
<span id="example-applications-plot-rank-filters-py"></span><h1>Rank filters<a class="headerlink" href="#rank-filters" title="Permalink to this headline">¶</a></h1>
<p>Rank filters are non-linear filters using the local gray-level ordering to
compute the filtered value. This ensemble of filters share a common base: the
local gray-level histogram is computed on the neighborhood of a pixel (defined
by a 2-D structuring element). If the filtered value is taken as the middle
value of the histogram, we get the classical median filter.</p>
<p>Rank filters can be used for several purposes such as:</p>
<ul class="simple">
<li>image quality enhancement
e.g. image smoothing, sharpening</li>
<li>image pre-processing
e.g. noise reduction, contrast enhancement</li>
<li>feature extraction
e.g. border detection, isolated point detection</li>
<li>post-processing
e.g. small object removal, object grouping, contour smoothing</li>
</ul>
<p>Some well known filters are specific cases of rank filters <a class="footnote-reference" href="#id2" id="id1">[1]</a> e.g.
morphological dilation, morphological erosion, median filters.</p>
<p>In this example, we will see how to filter a gray-level image using some of the
linear and non-linear filters available in skimage. We use the <cite>camera</cite> image
from <cite>skimage.data</cite> for all comparisons.</p>
<table class="docutils footnote" frame="void" id="id2" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[1]</td><td><em>(<a class="fn-backref" href="#id1">1</a>, <a class="fn-backref" href="#id7">2</a>)</em> Pierre Soille, On morphological operators based on rank filters, Pattern
Recognition 35 (2002) 527-535.</td></tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">img_as_ubyte</span>
<span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">noisy_image</span> <span class="o">=</span> <span class="n">img_as_ubyte</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">())</span>
<span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Histogram of grey values&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_1.png" src="../../_images/plot_rank_filters_1.png" />
<div class="section" id="noise-removal">
<h2>Noise removal<a class="headerlink" href="#noise-removal" title="Permalink to this headline">¶</a></h2>
<p>Some noise is added to the image, 1% of pixels are randomly set to 255, 1% are
randomly set to 0. The <strong>median</strong> filter is applied to remove the noise.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">skimage.filter.rank</span> <span class="kn">import</span> <span class="n">median</span>
<span class="kn">from</span> <span class="nn">skimage.morphology</span> <span class="kn">import</span> <span class="n">disk</span>

<span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">(</span><span class="n">noisy_image</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">noisy_image</span> <span class="o">=</span> <span class="n">img_as_ubyte</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">())</span>
<span class="n">noisy_image</span><span class="p">[</span><span class="n">noise</span> <span class="o">&gt;</span> <span class="mf">0.99</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span>
<span class="n">noisy_image</span><span class="p">[</span><span class="n">noise</span> <span class="o">&lt;</span> <span class="mf">0.01</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Noisy image&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">median</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">disk</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Median $r=1$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">median</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">disk</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Median $r=5$&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">median</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">disk</span><span class="p">(</span><span class="mi">20</span><span class="p">)),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Median $r=20$&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_2.png" src="../../_images/plot_rank_filters_2.png" />
<p>The added noise is efficiently removed, as the image defaults are small (1
pixel wide), a small filter radius is sufficient. As the radius is increasing,
objects with bigger sizes are filtered as well, such as the camera tripod. The
median filter is often used for noise removal because borders are preserved and
e.g. salt and pepper noise typically does not distort the gray-level.</p>
</div>
<div class="section" id="image-smoothing">
<h2>Image smoothing<a class="headerlink" href="#image-smoothing" title="Permalink to this headline">¶</a></h2>
<p>The example hereunder shows how a local <strong>mean</strong> filter smooths the camera man
image.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">skimage.filter.rank</span> <span class="kn">import</span> <span class="n">mean</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>

<span class="n">loc_mean</span> <span class="o">=</span> <span class="n">mean</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">disk</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">loc_mean</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Local mean $r=10$&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_3.png" src="../../_images/plot_rank_filters_3.png" />
<p>One may be interested in smoothing an image while preserving important borders
(median filters already achieved this), here we use the <strong>bilateral</strong> filter
that restricts the local neighborhood to pixel having a gray-level similar to
the central one.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">A different implementation is available for color images in
<cite>skimage.filter.denoise_bilateral</cite>.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">skimage.filter.rank</span> <span class="kn">import</span> <span class="n">mean_bilateral</span>

<span class="n">noisy_image</span> <span class="o">=</span> <span class="n">img_as_ubyte</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">())</span>

<span class="n">bilat</span> <span class="o">=</span> <span class="n">mean_bilateral</span><span class="p">(</span><span class="n">noisy_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">),</span> <span class="n">disk</span><span class="p">(</span><span class="mi">20</span><span class="p">),</span> <span class="n">s0</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">s1</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">bilat</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Bilateral mean&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">[</span><span class="mi">200</span><span class="p">:</span><span class="mi">350</span><span class="p">,</span> <span class="mi">350</span><span class="p">:</span><span class="mi">450</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">bilat</span><span class="p">[</span><span class="mi">200</span><span class="p">:</span><span class="mi">350</span><span class="p">,</span> <span class="mi">350</span><span class="p">:</span><span class="mi">450</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_4.png" src="../../_images/plot_rank_filters_4.png" />
<p>One can see that the large continuous part of the image (e.g. sky) is smoothed
whereas other details are preserved.</p>
</div>
<div class="section" id="contrast-enhancement">
<h2>Contrast enhancement<a class="headerlink" href="#contrast-enhancement" title="Permalink to this headline">¶</a></h2>
<p>We compare here how the global histogram equalization is applied locally.</p>
<p>The equalized image <a class="footnote-reference" href="#id5" id="id3">[2]</a> has a roughly linear cumulative distribution function
for each pixel neighborhood. The local version <a class="footnote-reference" href="#id6" id="id4">[3]</a> of the histogram
equalization emphasizes every local gray-level variations.</p>
<table class="docutils footnote" frame="void" id="id5" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id3">[2]</a></td><td><a class="reference external" href="http://en.wikipedia.org/wiki/Histogram_equalization">http://en.wikipedia.org/wiki/Histogram_equalization</a></td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id6" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id4">[3]</a></td><td><a class="reference external" href="http://en.wikipedia.org/wiki/Adaptive_histogram_equalization">http://en.wikipedia.org/wiki/Adaptive_histogram_equalization</a></td></tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">exposure</span>
<span class="kn">from</span> <span class="nn">skimage.filter</span> <span class="kn">import</span> <span class="n">rank</span>

<span class="n">noisy_image</span> <span class="o">=</span> <span class="n">img_as_ubyte</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">())</span>

<span class="c"># equalize globally and locally</span>
<span class="n">glob</span> <span class="o">=</span> <span class="n">exposure</span><span class="o">.</span><span class="n">equalize_hist</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">)</span> <span class="o">*</span> <span class="mi">255</span>
<span class="n">loc</span> <span class="o">=</span> <span class="n">rank</span><span class="o">.</span><span class="n">equalize</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">disk</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>

<span class="c"># extract histogram for each image</span>
<span class="n">hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
<span class="n">glob_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">glob</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>
<span class="n">loc_hist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span><span class="p">,</span> <span class="n">ax5</span><span class="p">,</span> <span class="n">ax6</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">hist</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">hist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Histogram of gray values&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">glob</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">glob_hist</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">glob_hist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Histogram of gray values&#39;</span><span class="p">)</span>

<span class="n">ax5</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax5</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax6</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">loc_hist</span><span class="p">[</span><span class="mi">1</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">loc_hist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax6</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Histogram of gray values&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_5.png" src="../../_images/plot_rank_filters_5.png" />
<p>Another way to maximize the number of gray-levels used for an image is to apply
a local auto-leveling, i.e. the gray-value of a pixel is proportionally
remapped between local minimum and local maximum.</p>
<p>The following example shows how local auto-level enhances the camara man
picture.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">skimage.filter.rank</span> <span class="kn">import</span> <span class="n">autolevel</span>

<span class="n">noisy_image</span> <span class="o">=</span> <span class="n">img_as_ubyte</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">())</span>

<span class="n">auto</span> <span class="o">=</span> <span class="n">autolevel</span><span class="p">(</span><span class="n">noisy_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">),</span> <span class="n">disk</span><span class="p">(</span><span class="mi">20</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">auto</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Local autolevel&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_6.png" src="../../_images/plot_rank_filters_6.png" />
<p>This filter is very sensitive to local outliers, see the little white spot in
the left part of the sky. This is due to a local maximum which is very high
comparing to the rest of the neighborhood. One can moderate this using the
percentile version of the auto-level filter which uses given percentiles (one
inferior, one superior) in place of local minimum and maximum. The example
below illustrates how the percentile parameters influence the local auto-level
result.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">skimage.filter.rank</span> <span class="kn">import</span> <span class="n">autolevel_percentile</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">()</span>

<span class="n">selem</span> <span class="o">=</span> <span class="n">disk</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span>
<span class="n">loc_autolevel</span> <span class="o">=</span> <span class="n">autolevel</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">selem</span><span class="o">=</span><span class="n">selem</span><span class="p">)</span>
<span class="n">loc_perc_autolevel0</span> <span class="o">=</span> <span class="n">autolevel_percentile</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">selem</span><span class="o">=</span><span class="n">selem</span><span class="p">,</span> <span class="n">p0</span><span class="o">=.</span><span class="mo">00</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
<span class="n">loc_perc_autolevel1</span> <span class="o">=</span> <span class="n">autolevel_percentile</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">selem</span><span class="o">=</span><span class="n">selem</span><span class="p">,</span> <span class="n">p0</span><span class="o">=.</span><span class="mo">01</span><span class="p">,</span> <span class="n">p1</span><span class="o">=.</span><span class="mi">99</span><span class="p">)</span>
<span class="n">loc_perc_autolevel2</span> <span class="o">=</span> <span class="n">autolevel_percentile</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">selem</span><span class="o">=</span><span class="n">selem</span><span class="p">,</span> <span class="n">p0</span><span class="o">=.</span><span class="mo">05</span><span class="p">,</span> <span class="n">p1</span><span class="o">=.</span><span class="mi">95</span><span class="p">)</span>
<span class="n">loc_perc_autolevel3</span> <span class="o">=</span> <span class="n">autolevel_percentile</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">selem</span><span class="o">=</span><span class="n">selem</span><span class="p">,</span> <span class="n">p0</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span> <span class="n">p1</span><span class="o">=.</span><span class="mi">9</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax0</span><span class="p">,</span> <span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span> <span class="o">=</span> <span class="n">axes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gray</span><span class="p">()</span>

<span class="n">ax0</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">image</span><span class="p">,</span> <span class="n">loc_autolevel</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax0</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Original / auto-level&#39;</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">loc_perc_autolevel0</span><span class="p">,</span> <span class="n">loc_perc_autolevel1</span><span class="p">)),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Percentile auto-level 0%,1%&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">loc_perc_autolevel2</span><span class="p">,</span> <span class="n">loc_perc_autolevel3</span><span class="p">)),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Percentile auto-level 5% and 10%&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">ax</span> <span class="ow">in</span> <span class="n">axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_7.png" src="../../_images/plot_rank_filters_7.png" />
<p>The morphological contrast enhancement filter replaces the central pixel by the
local maximum if the original pixel value is closest to local maximum,
otherwise by the minimum local.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">skimage.filter.rank</span> <span class="kn">import</span> <span class="n">enhance_contrast</span>

<span class="n">noisy_image</span> <span class="o">=</span> <span class="n">img_as_ubyte</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">())</span>

<span class="n">enh</span> <span class="o">=</span> <span class="n">enhance_contrast</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">disk</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">enh</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Local morphological contrast enhancement&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">[</span><span class="mi">200</span><span class="p">:</span><span class="mi">350</span><span class="p">,</span> <span class="mi">350</span><span class="p">:</span><span class="mi">450</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">enh</span><span class="p">[</span><span class="mi">200</span><span class="p">:</span><span class="mi">350</span><span class="p">,</span> <span class="mi">350</span><span class="p">:</span><span class="mi">450</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_8.png" src="../../_images/plot_rank_filters_8.png" />
<p>The percentile version of the local morphological contrast enhancement uses
percentile <em>p0</em> and <em>p1</em> instead of the local minimum and maximum.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">skimage.filter.rank</span> <span class="kn">import</span> <span class="n">enhance_contrast_percentile</span>

<span class="n">noisy_image</span> <span class="o">=</span> <span class="n">img_as_ubyte</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">())</span>

<span class="n">penh</span> <span class="o">=</span> <span class="n">enhance_contrast_percentile</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">disk</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span> <span class="n">p0</span><span class="o">=.</span><span class="mi">1</span><span class="p">,</span> <span class="n">p1</span><span class="o">=.</span><span class="mi">9</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">penh</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Local percentile morphological</span><span class="se">\n</span><span class="s"> contrast enhancement&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">[</span><span class="mi">200</span><span class="p">:</span><span class="mi">350</span><span class="p">,</span> <span class="mi">350</span><span class="p">:</span><span class="mi">450</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">penh</span><span class="p">[</span><span class="mi">200</span><span class="p">:</span><span class="mi">350</span><span class="p">,</span> <span class="mi">350</span><span class="p">:</span><span class="mi">450</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_9.png" src="../../_images/plot_rank_filters_9.png" />
</div>
<div class="section" id="image-threshold">
<h2>Image threshold<a class="headerlink" href="#image-threshold" title="Permalink to this headline">¶</a></h2>
<p>The Otsu threshold <a class="footnote-reference" href="#id2" id="id7">[1]</a> method can be applied locally using the local gray-
level distribution. In the example below, for each pixel, an &#8220;optimal&#8221;
threshold is determined by maximizing the variance between two classes of
pixels of the local neighborhood defined by a structuring element.</p>
<p>The example compares the local threshold with the global threshold
<cite>skimage.filter.threshold_otsu</cite>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Local is much slower than global thresholding. A function for global Otsu
thresholding can be found in : <cite>skimage.filter.threshold_otsu</cite>.</p>
</div>
<table class="docutils footnote" frame="void" id="id8" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label">[4]</td><td><a class="reference external" href="http://en.wikipedia.org/wiki/Otsu's_method">http://en.wikipedia.org/wiki/Otsu&#8217;s_method</a></td></tr>
</tbody>
</table>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">skimage.filter.rank</span> <span class="kn">import</span> <span class="n">otsu</span>
<span class="kn">from</span> <span class="nn">skimage.filter</span> <span class="kn">import</span> <span class="n">threshold_otsu</span>

<span class="n">p8</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">page</span><span class="p">()</span>

<span class="n">radius</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">selem</span> <span class="o">=</span> <span class="n">disk</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>

<span class="c"># t_loc_otsu is an image</span>
<span class="n">t_loc_otsu</span> <span class="o">=</span> <span class="n">otsu</span><span class="p">(</span><span class="n">p8</span><span class="p">,</span> <span class="n">selem</span><span class="p">)</span>
<span class="n">loc_otsu</span> <span class="o">=</span> <span class="n">p8</span> <span class="o">&gt;=</span> <span class="n">t_loc_otsu</span>

<span class="c"># t_glob_otsu is a scalar</span>
<span class="n">t_glob_otsu</span> <span class="o">=</span> <span class="n">threshold_otsu</span><span class="p">(</span><span class="n">p8</span><span class="p">)</span>
<span class="n">glob_otsu</span> <span class="o">=</span> <span class="n">p8</span> <span class="o">&gt;=</span> <span class="n">t_glob_otsu</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">p8</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">t_loc_otsu</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Local Otsu ($r=</span><span class="si">%d</span><span class="s">$)&#39;</span> <span class="o">%</span> <span class="n">radius</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">p8</span> <span class="o">&gt;=</span> <span class="n">t_loc_otsu</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Original &gt;= local Otsu&#39;</span> <span class="o">%</span> <span class="n">t_glob_otsu</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">glob_otsu</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Global Otsu ($t=</span><span class="si">%d</span><span class="s">$)&#39;</span> <span class="o">%</span> <span class="n">t_glob_otsu</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_10.png" src="../../_images/plot_rank_filters_10.png" />
<p>The following example shows how local Otsu thresholding handles a global level
shift applied to a synthetic image.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">n</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span>
<span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="mi">128</span> <span class="o">+</span> <span class="mi">128</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>

<span class="n">radius</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">rank</span><span class="o">.</span><span class="n">otsu</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">disk</span><span class="p">(</span><span class="n">radius</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">m</span> <span class="o">&gt;=</span> <span class="n">t</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s">&#39;nearest&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Local Otsu ($r=</span><span class="si">%d</span><span class="s">$)&#39;</span> <span class="o">%</span> <span class="n">radius</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_11.png" src="../../_images/plot_rank_filters_11.png" />
</div>
<div class="section" id="image-morphology">
<h2>Image morphology<a class="headerlink" href="#image-morphology" title="Permalink to this headline">¶</a></h2>
<p>Local maximum and local minimum are the base operators for gray-level
morphology.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><cite>skimage.dilate</cite> and <cite>skimage.erode</cite> are equivalent filters (see below for
comparison).</p>
</div>
<p>Here is an example of the classical morphological gray-level filters: opening,
closing and morphological gradient.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">skimage.filter.rank</span> <span class="kn">import</span> <span class="n">maximum</span><span class="p">,</span> <span class="n">minimum</span><span class="p">,</span> <span class="n">gradient</span>

<span class="n">noisy_image</span> <span class="o">=</span> <span class="n">img_as_ubyte</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">())</span>

<span class="n">closing</span> <span class="o">=</span> <span class="n">maximum</span><span class="p">(</span><span class="n">minimum</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">disk</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span> <span class="n">disk</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">opening</span> <span class="o">=</span> <span class="n">minimum</span><span class="p">(</span><span class="n">maximum</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">disk</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span> <span class="n">disk</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">grad</span> <span class="o">=</span> <span class="n">gradient</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">disk</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>

<span class="c"># display results</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">])</span>
<span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">,</span> <span class="n">ax3</span><span class="p">,</span> <span class="n">ax4</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">noisy_image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Original&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">closing</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Gray-level closing&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">opening</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Gray-level opening&#39;</span><span class="p">)</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">grad</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Morphological gradient&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_12.png" src="../../_images/plot_rank_filters_12.png" />
</div>
<div class="section" id="feature-extraction">
<h2>Feature extraction<a class="headerlink" href="#feature-extraction" title="Permalink to this headline">¶</a></h2>
<p>Local histograms can be exploited to compute local entropy, which is related to
the local image complexity. Entropy is computed using base 2 logarithm i.e. the
filter returns the minimum number of bits needed to encode local gray-level
distribution.</p>
<p><cite>skimage.rank.entropy</cite> returns the local entropy on a given structuring
element. The following example shows applies this filter on 8- and 16-bit
images.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">to better use the available image bit, the function returns 10x entropy for
8-bit images and 1000x entropy for 16-bit images.</p>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">skimage</span> <span class="kn">import</span> <span class="n">data</span>
<span class="kn">from</span> <span class="nn">skimage.filter.rank</span> <span class="kn">import</span> <span class="n">entropy</span>
<span class="kn">from</span> <span class="nn">skimage.morphology</span> <span class="kn">import</span> <span class="n">disk</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="n">image</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">ax2</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">gray</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Image&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ax2</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">entropy</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">disk</span><span class="p">(</span><span class="mi">5</span><span class="p">)),</span> <span class="n">cmap</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">jet</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Entropy&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_13.png" src="../../_images/plot_rank_filters_13.png" />
</div>
<div class="section" id="implementation">
<h2>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h2>
<p>The central part of the <cite>skimage.rank</cite> filters is build on a sliding window
that updates the local gray-level histogram. This approach limits the algorithm
complexity to O(n) where n is the number of image pixels. The complexity is
also limited with respect to the structuring element size.</p>
<p>In the following we compare the performance of different implementations
available in <cite>skimage</cite>.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="kn">from</span> <span class="nn">scipy.ndimage.filters</span> <span class="kn">import</span> <span class="n">percentile_filter</span>
<span class="kn">from</span> <span class="nn">skimage.morphology</span> <span class="kn">import</span> <span class="n">dilation</span>
<span class="kn">from</span> <span class="nn">skimage.filter.rank</span> <span class="kn">import</span> <span class="n">median</span><span class="p">,</span> <span class="n">maximum</span>


<span class="k">def</span> <span class="nf">exec_and_timeit</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator that returns both function results and execution time.&quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">):</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">arg</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="n">ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">t2</span> <span class="o">-</span> <span class="n">t1</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1000.0</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">ms</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">wrapper</span>


<span class="nd">@exec_and_timeit</span>
<span class="k">def</span> <span class="nf">cr_med</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">selem</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">median</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">selem</span><span class="o">=</span><span class="n">selem</span><span class="p">)</span>


<span class="nd">@exec_and_timeit</span>
<span class="k">def</span> <span class="nf">cr_max</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">selem</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">maximum</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">selem</span><span class="o">=</span><span class="n">selem</span><span class="p">)</span>


<span class="nd">@exec_and_timeit</span>
<span class="k">def</span> <span class="nf">cm_dil</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">selem</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">dilation</span><span class="p">(</span><span class="n">image</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">selem</span><span class="o">=</span><span class="n">selem</span><span class="p">)</span>


<span class="nd">@exec_and_timeit</span>
<span class="k">def</span> <span class="nf">ndi_med</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">percentile_filter</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>Comparison between</p>
<ul class="simple">
<li><cite>filter.rank.maximum</cite></li>
<li><cite>morphology.dilate</cite></li>
</ul>
<p>on increasing structuring element size:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">()</span>

<span class="n">rec</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">e_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e_range</span><span class="p">:</span>
    <span class="n">elem</span> <span class="o">=</span> <span class="n">disk</span><span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">rc</span><span class="p">,</span> <span class="n">ms_rc</span> <span class="o">=</span> <span class="n">cr_max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
    <span class="n">rcm</span><span class="p">,</span> <span class="n">ms_rcm</span> <span class="o">=</span> <span class="n">cm_dil</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
    <span class="n">rec</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ms_rc</span><span class="p">,</span> <span class="n">ms_rcm</span><span class="p">))</span>

<span class="n">rec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Performance with respect to element size&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Time (ms)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Element radius&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">e_range</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;filter.rank.maximum&#39;</span><span class="p">,</span> <span class="s">&#39;morphology.dilate&#39;</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_14.png" src="../../_images/plot_rank_filters_14.png" />
<p>and increasing image size:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">elem</span> <span class="o">=</span> <span class="n">disk</span><span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">rec</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">s_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s_range</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span> <span class="o">*</span> <span class="mi">256</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">ms_rc</span><span class="p">)</span> <span class="o">=</span> <span class="n">cr_max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
    <span class="p">(</span><span class="n">rcm</span><span class="p">,</span> <span class="n">ms_rcm</span><span class="p">)</span> <span class="o">=</span> <span class="n">cm_dil</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
    <span class="n">rec</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ms_rc</span><span class="p">,</span> <span class="n">ms_rcm</span><span class="p">))</span>

<span class="n">rec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Performance with respect to image size&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Time (ms)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Image size&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s_range</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;filter.rank.maximum&#39;</span><span class="p">,</span> <span class="s">&#39;morphology.dilate&#39;</span><span class="p">])</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_15.png" src="../../_images/plot_rank_filters_15.png" />
<p>Comparison between:</p>
<ul class="simple">
<li><cite>filter.rank.median</cite></li>
<li><cite>scipy.ndimage.percentile</cite></li>
</ul>
<p>on increasing structuring element size:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">a</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">camera</span><span class="p">()</span>

<span class="n">rec</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">e_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">e_range</span><span class="p">:</span>
    <span class="n">elem</span> <span class="o">=</span> <span class="n">disk</span><span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">rc</span><span class="p">,</span> <span class="n">ms_rc</span> <span class="o">=</span> <span class="n">cr_med</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
    <span class="n">rndi</span><span class="p">,</span> <span class="n">ms_ndi</span> <span class="o">=</span> <span class="n">ndi_med</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
    <span class="n">rec</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ms_rc</span><span class="p">,</span> <span class="n">ms_ndi</span><span class="p">))</span>

<span class="n">rec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Performance with respect to element size&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">e_range</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;filter.rank.median&#39;</span><span class="p">,</span> <span class="s">&#39;scipy.ndimage.percentile&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Time (ms)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Element radius&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_16.png" src="../../_images/plot_rank_filters_16.png" />
<p>Comparison of outcome of the three methods:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">rc</span><span class="p">,</span> <span class="n">rndi</span><span class="p">)))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;filter.rank.median vs. scipy.ndimage.percentile&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s">&#39;off&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_17.png" src="../../_images/plot_rank_filters_17.png" />
<p>and increasing image size:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">r</span> <span class="o">=</span> <span class="mi">9</span>
<span class="n">elem</span> <span class="o">=</span> <span class="n">disk</span><span class="p">(</span><span class="n">r</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">rec</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">s_range</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">s_range</span><span class="p">:</span>
    <span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="n">s</span><span class="p">,</span> <span class="n">s</span><span class="p">))</span> <span class="o">*</span> <span class="mi">256</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="p">(</span><span class="n">rc</span><span class="p">,</span> <span class="n">ms_rc</span><span class="p">)</span> <span class="o">=</span> <span class="n">cr_med</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">elem</span><span class="p">)</span>
    <span class="n">rndi</span><span class="p">,</span> <span class="n">ms_ndi</span> <span class="o">=</span> <span class="n">ndi_med</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
    <span class="n">rec</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">ms_rc</span><span class="p">,</span> <span class="n">ms_ndi</span><span class="p">))</span>

<span class="n">rec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">rec</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s">&#39;Performance with respect to image size&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">s_range</span><span class="p">,</span> <span class="n">rec</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s">&#39;filter.rank.median&#39;</span><span class="p">,</span> <span class="s">&#39;scipy.ndimage.percentile&#39;</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s">&#39;Time (ms)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s">&#39;Image size&#39;</span><span class="p">)</span>
</pre></div>
</div>
<img alt="../../_images/plot_rank_filters_18.png" src="../../_images/plot_rank_filters_18.png" />
<div class="highlight-python"><div class="highlight"><pre><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p id="run_btn">
    <button type="button" class="btn btn-default btn-lg" id="runcode">
        <i class="icon-play"></i> Run
    </button>
    <button type="button" class="btn btn-default btn-lg" id="reload">
        <i class="icon-refresh"></i>
    </button>
    <img id="loading" src="../_static/ajax-loader.gif"/>
</p><p>
    <div class="alert alert-success" id="success-message"></div>
    <div class="alert alert-error" id="error-message"></div>
    <div class="all-output">
        <p class="stdout-group">
            <i class="icon-info-sign"></i> <u>STDOUT</u>
        </p>
        <pre id="stdout"></pre>
        <hr class="stdout-group">
        <p class="stderr-group">
            <i class="icon-remove-sign"></i> <u>STDERR</u>
        </p>
        <pre id="stderr"></pre>
        <hr class="stderr-group">
    </div>
</p><p><strong>Python source code:</strong> <a class="reference download internal" href="../../_downloads/plot_rank_filters.py"><tt class="xref download docutils literal"><span class="pre">download</span></tt></a>
(generated using <tt class="docutils literal"><span class="pre">skimage</span></tt> 0.11dev)</p>
<p><strong>IPython Notebook:</strong> <a class="reference download internal" href="../../_downloads/plot_rank_filters.ipynb"><tt class="xref download docutils literal"><span class="pre">download</span></tt></a>
(generated using <tt class="docutils literal"><span class="pre">skimage</span></tt> 0.11dev)</p>
<div class="tobehidden">CmltcG9ydCBudW1weSBhcyBucAppbXBvcnQgbWF0cGxvdGxpYi5weXBsb3QgYXMgcGx0Cgpmcm9tIHNraW1hZ2UgaW1wb3J0IGltZ19hc191Ynl0ZQpmcm9tIHNraW1hZ2UgaW1wb3J0IGRhdGEKCm5vaXN5X2ltYWdlID0gaW1nX2FzX3VieXRlKGRhdGEuY2FtZXJhKCkpCmhpc3QgPSBucC5oaXN0b2dyYW0obm9pc3lfaW1hZ2UsIGJpbnM9bnAuYXJhbmdlKDAsIDI1NikpCgpmaWcsIChheDEsIGF4MikgPSBwbHQuc3VicGxvdHMoMSwgMiwgZmlnc2l6ZT0oOCwgMykpCmF4MS5pbXNob3cobm9pc3lfaW1hZ2UsIGludGVycG9sYXRpb249J25lYXJlc3QnLCBjbWFwPXBsdC5jbS5ncmF5KQpheDEuYXhpcygnb2ZmJykKYXgyLnBsb3QoaGlzdFsxXVs6LTFdLCBoaXN0WzBdLCBsdz0yKQpheDIuc2V0X3RpdGxlKCdIaXN0b2dyYW0gb2YgZ3JleSB2YWx1ZXMnKQ==</div><div class="tobehidden">CmZyb20gc2tpbWFnZS5maWx0ZXIucmFuayBpbXBvcnQgbWVkaWFuCmZyb20gc2tpbWFnZS5tb3JwaG9sb2d5IGltcG9ydCBkaXNrCgpub2lzZSA9IG5wLnJhbmRvbS5yYW5kb20obm9pc3lfaW1hZ2Uuc2hhcGUpCm5vaXN5X2ltYWdlID0gaW1nX2FzX3VieXRlKGRhdGEuY2FtZXJhKCkpCm5vaXN5X2ltYWdlW25vaXNlID4gMC45OV0gPSAyNTUKbm9pc3lfaW1hZ2Vbbm9pc2UgPCAwLjAxXSA9IDAKCmZpZywgYXggPSBwbHQuc3VicGxvdHMoMiwgMiwgZmlnc2l6ZT0oMTAsIDcpKQpheDEsIGF4MiwgYXgzLCBheDQgPSBheC5yYXZlbCgpCgpheDEuaW1zaG93KG5vaXN5X2ltYWdlLCB2bWluPTAsIHZtYXg9MjU1LCBjbWFwPXBsdC5jbS5ncmF5KQpheDEuc2V0X3RpdGxlKCdOb2lzeSBpbWFnZScpCmF4MS5heGlzKCdvZmYnKQoKYXgyLmltc2hvdyhtZWRpYW4obm9pc3lfaW1hZ2UsIGRpc2soMSkpLCB2bWluPTAsIHZtYXg9MjU1LCBjbWFwPXBsdC5jbS5ncmF5KQpheDIuc2V0X3RpdGxlKCdNZWRpYW4gJHI9MSQnKQpheDIuYXhpcygnb2ZmJykKCmF4My5pbXNob3cobWVkaWFuKG5vaXN5X2ltYWdlLCBkaXNrKDUpKSwgdm1pbj0wLCB2bWF4PTI1NSwgY21hcD1wbHQuY20uZ3JheSkKYXgzLnNldF90aXRsZSgnTWVkaWFuICRyPTUkJykKYXgzLmF4aXMoJ29mZicpCgpheDQuaW1zaG93KG1lZGlhbihub2lzeV9pbWFnZSwgZGlzaygyMCkpLCB2bWluPTAsIHZtYXg9MjU1LCBjbWFwPXBsdC5jbS5ncmF5KQpheDQuc2V0X3RpdGxlKCdNZWRpYW4gJHI9MjAkJykKYXg0LmF4aXMoJ29mZicp</div><div class="tobehidden">CmZyb20gc2tpbWFnZS5maWx0ZXIucmFuayBpbXBvcnQgbWVhbgoKZmlnLCAoYXgxLCBheDIpID0gcGx0LnN1YnBsb3RzKDEsIDIsIGZpZ3NpemU9WzEwLCA3XSkKCmxvY19tZWFuID0gbWVhbihub2lzeV9pbWFnZSwgZGlzaygxMCkpCgpheDEuaW1zaG93KG5vaXN5X2ltYWdlLCB2bWluPTAsIHZtYXg9MjU1LCBjbWFwPXBsdC5jbS5ncmF5KQpheDEuc2V0X3RpdGxlKCdPcmlnaW5hbCcpCmF4MS5heGlzKCdvZmYnKQoKYXgyLmltc2hvdyhsb2NfbWVhbiwgdm1pbj0wLCB2bWF4PTI1NSwgY21hcD1wbHQuY20uZ3JheSkKYXgyLnNldF90aXRsZSgnTG9jYWwgbWVhbiAkcj0xMCQnKQpheDIuYXhpcygnb2ZmJyk=</div><div class="tobehidden">CmZyb20gc2tpbWFnZS5maWx0ZXIucmFuayBpbXBvcnQgbWVhbl9iaWxhdGVyYWwKCm5vaXN5X2ltYWdlID0gaW1nX2FzX3VieXRlKGRhdGEuY2FtZXJhKCkpCgpiaWxhdCA9IG1lYW5fYmlsYXRlcmFsKG5vaXN5X2ltYWdlLmFzdHlwZShucC51aW50MTYpLCBkaXNrKDIwKSwgczA9MTAsIHMxPTEwKQoKZmlnLCBheCA9IHBsdC5zdWJwbG90cygyLCAyLCBmaWdzaXplPSgxMCwgNykpCmF4MSwgYXgyLCBheDMsIGF4NCA9IGF4LnJhdmVsKCkKCmF4MS5pbXNob3cobm9pc3lfaW1hZ2UsIGNtYXA9cGx0LmNtLmdyYXkpCmF4MS5zZXRfdGl0bGUoJ09yaWdpbmFsJykKYXgxLmF4aXMoJ29mZicpCgpheDIuaW1zaG93KGJpbGF0LCBjbWFwPXBsdC5jbS5ncmF5KQpheDIuc2V0X3RpdGxlKCdCaWxhdGVyYWwgbWVhbicpCmF4Mi5heGlzKCdvZmYnKQoKYXgzLmltc2hvdyhub2lzeV9pbWFnZVsyMDA6MzUwLCAzNTA6NDUwXSwgY21hcD1wbHQuY20uZ3JheSkKYXgzLmF4aXMoJ29mZicpCgpheDQuaW1zaG93KGJpbGF0WzIwMDozNTAsIDM1MDo0NTBdLCBjbWFwPXBsdC5jbS5ncmF5KQpheDQuYXhpcygnb2ZmJyk=</div><div class="tobehidden">CmZyb20gc2tpbWFnZSBpbXBvcnQgZXhwb3N1cmUKZnJvbSBza2ltYWdlLmZpbHRlciBpbXBvcnQgcmFuawoKbm9pc3lfaW1hZ2UgPSBpbWdfYXNfdWJ5dGUoZGF0YS5jYW1lcmEoKSkKCiMgZXF1YWxpemUgZ2xvYmFsbHkgYW5kIGxvY2FsbHkKZ2xvYiA9IGV4cG9zdXJlLmVxdWFsaXplX2hpc3Qobm9pc3lfaW1hZ2UpICogMjU1CmxvYyA9IHJhbmsuZXF1YWxpemUobm9pc3lfaW1hZ2UsIGRpc2soMjApKQoKIyBleHRyYWN0IGhpc3RvZ3JhbSBmb3IgZWFjaCBpbWFnZQpoaXN0ID0gbnAuaGlzdG9ncmFtKG5vaXN5X2ltYWdlLCBiaW5zPW5wLmFyYW5nZSgwLCAyNTYpKQpnbG9iX2hpc3QgPSBucC5oaXN0b2dyYW0oZ2xvYiwgYmlucz1ucC5hcmFuZ2UoMCwgMjU2KSkKbG9jX2hpc3QgPSBucC5oaXN0b2dyYW0obG9jLCBiaW5zPW5wLmFyYW5nZSgwLCAyNTYpKQoKZmlnLCBheCA9IHBsdC5zdWJwbG90cygzLCAyLCBmaWdzaXplPSgxMCwgMTApKQpheDEsIGF4MiwgYXgzLCBheDQsIGF4NSwgYXg2ID0gYXgucmF2ZWwoKQoKYXgxLmltc2hvdyhub2lzeV9pbWFnZSwgaW50ZXJwb2xhdGlvbj0nbmVhcmVzdCcsIGNtYXA9cGx0LmNtLmdyYXkpCmF4MS5heGlzKCdvZmYnKQoKYXgyLnBsb3QoaGlzdFsxXVs6LTFdLCBoaXN0WzBdLCBsdz0yKQpheDIuc2V0X3RpdGxlKCdIaXN0b2dyYW0gb2YgZ3JheSB2YWx1ZXMnKQoKYXgzLmltc2hvdyhnbG9iLCBpbnRlcnBvbGF0aW9uPSduZWFyZXN0JywgY21hcD1wbHQuY20uZ3JheSkKYXgzLmF4aXMoJ29mZicpCgpheDQucGxvdChnbG9iX2hpc3RbMV1bOi0xXSwgZ2xvYl9oaXN0WzBdLCBsdz0yKQpheDQuc2V0X3RpdGxlKCdIaXN0b2dyYW0gb2YgZ3JheSB2YWx1ZXMnKQoKYXg1Lmltc2hvdyhsb2MsIGludGVycG9sYXRpb249J25lYXJlc3QnLCBjbWFwPXBsdC5jbS5ncmF5KQpheDUuYXhpcygnb2ZmJykKCmF4Ni5wbG90KGxvY19oaXN0WzFdWzotMV0sIGxvY19oaXN0WzBdLCBsdz0yKQpheDYuc2V0X3RpdGxlKCdIaXN0b2dyYW0gb2YgZ3JheSB2YWx1ZXMnKQ==</div><div class="tobehidden">CmZyb20gc2tpbWFnZS5maWx0ZXIucmFuayBpbXBvcnQgYXV0b2xldmVsCgpub2lzeV9pbWFnZSA9IGltZ19hc191Ynl0ZShkYXRhLmNhbWVyYSgpKQoKYXV0byA9IGF1dG9sZXZlbChub2lzeV9pbWFnZS5hc3R5cGUobnAudWludDE2KSwgZGlzaygyMCkpCgpmaWcsIChheDEsIGF4MikgPSBwbHQuc3VicGxvdHMoMSwgMiwgZmlnc2l6ZT1bMTAsIDddKQoKYXgxLmltc2hvdyhub2lzeV9pbWFnZSwgY21hcD1wbHQuY20uZ3JheSkKYXgxLnNldF90aXRsZSgnT3JpZ2luYWwnKQpheDEuYXhpcygnb2ZmJykKCmF4Mi5pbXNob3coYXV0bywgY21hcD1wbHQuY20uZ3JheSkKYXgyLnNldF90aXRsZSgnTG9jYWwgYXV0b2xldmVsJykKYXgyLmF4aXMoJ29mZicp</div><div class="tobehidden">CmZyb20gc2tpbWFnZS5maWx0ZXIucmFuayBpbXBvcnQgYXV0b2xldmVsX3BlcmNlbnRpbGUKCmltYWdlID0gZGF0YS5jYW1lcmEoKQoKc2VsZW0gPSBkaXNrKDIwKQpsb2NfYXV0b2xldmVsID0gYXV0b2xldmVsKGltYWdlLCBzZWxlbT1zZWxlbSkKbG9jX3BlcmNfYXV0b2xldmVsMCA9IGF1dG9sZXZlbF9wZXJjZW50aWxlKGltYWdlLCBzZWxlbT1zZWxlbSwgcDA9LjAwLCBwMT0xLjApCmxvY19wZXJjX2F1dG9sZXZlbDEgPSBhdXRvbGV2ZWxfcGVyY2VudGlsZShpbWFnZSwgc2VsZW09c2VsZW0sIHAwPS4wMSwgcDE9Ljk5KQpsb2NfcGVyY19hdXRvbGV2ZWwyID0gYXV0b2xldmVsX3BlcmNlbnRpbGUoaW1hZ2UsIHNlbGVtPXNlbGVtLCBwMD0uMDUsIHAxPS45NSkKbG9jX3BlcmNfYXV0b2xldmVsMyA9IGF1dG9sZXZlbF9wZXJjZW50aWxlKGltYWdlLCBzZWxlbT1zZWxlbSwgcDA9LjEsIHAxPS45KQoKZmlnLCBheGVzID0gcGx0LnN1YnBsb3RzKG5yb3dzPTMsIGZpZ3NpemU9KDcsIDgpKQpheDAsIGF4MSwgYXgyID0gYXhlcwpwbHQuZ3JheSgpCgpheDAuaW1zaG93KG5wLmhzdGFjaygoaW1hZ2UsIGxvY19hdXRvbGV2ZWwpKSwgY21hcD1wbHQuY20uZ3JheSkKYXgwLnNldF90aXRsZSgnT3JpZ2luYWwgLyBhdXRvLWxldmVsJykKCmF4MS5pbXNob3coCiAgICBucC5oc3RhY2soKGxvY19wZXJjX2F1dG9sZXZlbDAsIGxvY19wZXJjX2F1dG9sZXZlbDEpKSwgdm1pbj0wLCB2bWF4PTI1NSkKYXgxLnNldF90aXRsZSgnUGVyY2VudGlsZSBhdXRvLWxldmVsIDAlLDElJykKYXgyLmltc2hvdygKICAgIG5wLmhzdGFjaygobG9jX3BlcmNfYXV0b2xldmVsMiwgbG9jX3BlcmNfYXV0b2xldmVsMykpLCB2bWluPTAsIHZtYXg9MjU1KQpheDIuc2V0X3RpdGxlKCdQZXJjZW50aWxlIGF1dG8tbGV2ZWwgNSUgYW5kIDEwJScpCgpmb3IgYXggaW4gYXhlczoKICAgIGF4LmF4aXMoJ29mZicp</div><div class="tobehidden">CmZyb20gc2tpbWFnZS5maWx0ZXIucmFuayBpbXBvcnQgZW5oYW5jZV9jb250cmFzdAoKbm9pc3lfaW1hZ2UgPSBpbWdfYXNfdWJ5dGUoZGF0YS5jYW1lcmEoKSkKCmVuaCA9IGVuaGFuY2VfY29udHJhc3Qobm9pc3lfaW1hZ2UsIGRpc2soNSkpCgpmaWcsIGF4ID0gcGx0LnN1YnBsb3RzKDIsIDIsIGZpZ3NpemU9WzEwLCA3XSkKYXgxLCBheDIsIGF4MywgYXg0ID0gYXgucmF2ZWwoKQoKYXgxLmltc2hvdyhub2lzeV9pbWFnZSwgY21hcD1wbHQuY20uZ3JheSkKYXgxLnNldF90aXRsZSgnT3JpZ2luYWwnKQpheDEuYXhpcygnb2ZmJykKCmF4Mi5pbXNob3coZW5oLCBjbWFwPXBsdC5jbS5ncmF5KQpheDIuc2V0X3RpdGxlKCdMb2NhbCBtb3JwaG9sb2dpY2FsIGNvbnRyYXN0IGVuaGFuY2VtZW50JykKYXgyLmF4aXMoJ29mZicpCgpheDMuaW1zaG93KG5vaXN5X2ltYWdlWzIwMDozNTAsIDM1MDo0NTBdLCBjbWFwPXBsdC5jbS5ncmF5KQpheDMuYXhpcygnb2ZmJykKCmF4NC5pbXNob3coZW5oWzIwMDozNTAsIDM1MDo0NTBdLCBjbWFwPXBsdC5jbS5ncmF5KQpheDQuYXhpcygnb2ZmJyk=</div><div class="tobehidden">CmZyb20gc2tpbWFnZS5maWx0ZXIucmFuayBpbXBvcnQgZW5oYW5jZV9jb250cmFzdF9wZXJjZW50aWxlCgpub2lzeV9pbWFnZSA9IGltZ19hc191Ynl0ZShkYXRhLmNhbWVyYSgpKQoKcGVuaCA9IGVuaGFuY2VfY29udHJhc3RfcGVyY2VudGlsZShub2lzeV9pbWFnZSwgZGlzayg1KSwgcDA9LjEsIHAxPS45KQoKZmlnLCBheCA9IHBsdC5zdWJwbG90cygyLCAyLCBmaWdzaXplPVsxMCwgN10pCmF4MSwgYXgyLCBheDMsIGF4NCA9IGF4LnJhdmVsKCkKCmF4MS5pbXNob3cobm9pc3lfaW1hZ2UsIGNtYXA9cGx0LmNtLmdyYXkpCmF4MS5zZXRfdGl0bGUoJ09yaWdpbmFsJykKYXgxLmF4aXMoJ29mZicpCgpheDIuaW1zaG93KHBlbmgsIGNtYXA9cGx0LmNtLmdyYXkpCmF4Mi5zZXRfdGl0bGUoJ0xvY2FsIHBlcmNlbnRpbGUgbW9ycGhvbG9naWNhbFxuIGNvbnRyYXN0IGVuaGFuY2VtZW50JykKYXgyLmF4aXMoJ29mZicpCgpheDMuaW1zaG93KG5vaXN5X2ltYWdlWzIwMDozNTAsIDM1MDo0NTBdLCBjbWFwPXBsdC5jbS5ncmF5KQpheDMuYXhpcygnb2ZmJykKCmF4NC5pbXNob3cocGVuaFsyMDA6MzUwLCAzNTA6NDUwXSwgY21hcD1wbHQuY20uZ3JheSkKYXg0LmF4aXMoJ29mZicp</div><div class="tobehidden">CmZyb20gc2tpbWFnZS5maWx0ZXIucmFuayBpbXBvcnQgb3RzdQpmcm9tIHNraW1hZ2UuZmlsdGVyIGltcG9ydCB0aHJlc2hvbGRfb3RzdQoKcDggPSBkYXRhLnBhZ2UoKQoKcmFkaXVzID0gMTAKc2VsZW0gPSBkaXNrKHJhZGl1cykKCiMgdF9sb2Nfb3RzdSBpcyBhbiBpbWFnZQp0X2xvY19vdHN1ID0gb3RzdShwOCwgc2VsZW0pCmxvY19vdHN1ID0gcDggPj0gdF9sb2Nfb3RzdQoKIyB0X2dsb2Jfb3RzdSBpcyBhIHNjYWxhcgp0X2dsb2Jfb3RzdSA9IHRocmVzaG9sZF9vdHN1KHA4KQpnbG9iX290c3UgPSBwOCA+PSB0X2dsb2Jfb3RzdQoKZmlnLCBheCA9IHBsdC5zdWJwbG90cygyLCAyKQpheDEsIGF4MiwgYXgzLCBheDQgPSBheC5yYXZlbCgpCgpmaWcuY29sb3JiYXIoYXgxLmltc2hvdyhwOCwgY21hcD1wbHQuY20uZ3JheSksIGF4PWF4MSkKYXgxLnNldF90aXRsZSgnT3JpZ2luYWwnKQpheDEuYXhpcygnb2ZmJykKCmZpZy5jb2xvcmJhcihheDIuaW1zaG93KHRfbG9jX290c3UsIGNtYXA9cGx0LmNtLmdyYXkpLCBheD1heDIpCmF4Mi5zZXRfdGl0bGUoJ0xvY2FsIE90c3UgKCRyPSVkJCknICUgcmFkaXVzKQpheDIuYXhpcygnb2ZmJykKCmF4My5pbXNob3cocDggPj0gdF9sb2Nfb3RzdSwgY21hcD1wbHQuY20uZ3JheSkKYXgzLnNldF90aXRsZSgnT3JpZ2luYWwgPj0gbG9jYWwgT3RzdScgJSB0X2dsb2Jfb3RzdSkKYXgzLmF4aXMoJ29mZicpCgpheDQuaW1zaG93KGdsb2Jfb3RzdSwgY21hcD1wbHQuY20uZ3JheSkKYXg0LnNldF90aXRsZSgnR2xvYmFsIE90c3UgKCR0PSVkJCknICUgdF9nbG9iX290c3UpCmF4NC5heGlzKCdvZmYnKQ==</div><div class="tobehidden">Cm4gPSAxMDAKdGhldGEgPSBucC5saW5zcGFjZSgwLCAxMCAqIG5wLnBpLCBuKQp4ID0gbnAuc2luKHRoZXRhKQptID0gKG5wLnRpbGUoeCwgKG4sIDEpKSAqIG5wLmxpbnNwYWNlKDAuMSwgMSwgbikgKiAxMjggKyAxMjgpLmFzdHlwZShucC51aW50OCkKCnJhZGl1cyA9IDEwCnQgPSByYW5rLm90c3UobSwgZGlzayhyYWRpdXMpKQoKZmlnLCAoYXgxLCBheDIpID0gcGx0LnN1YnBsb3RzKDEsIDIpCgpheDEuaW1zaG93KG0pCmF4MS5zZXRfdGl0bGUoJ09yaWdpbmFsJykKYXgxLmF4aXMoJ29mZicpCgpheDIuaW1zaG93KG0gPj0gdCwgaW50ZXJwb2xhdGlvbj0nbmVhcmVzdCcpCmF4Mi5zZXRfdGl0bGUoJ0xvY2FsIE90c3UgKCRyPSVkJCknICUgcmFkaXVzKQpheDIuYXhpcygnb2ZmJyk=</div><div class="tobehidden">CmZyb20gc2tpbWFnZS5maWx0ZXIucmFuayBpbXBvcnQgbWF4aW11bSwgbWluaW11bSwgZ3JhZGllbnQKCm5vaXN5X2ltYWdlID0gaW1nX2FzX3VieXRlKGRhdGEuY2FtZXJhKCkpCgpjbG9zaW5nID0gbWF4aW11bShtaW5pbXVtKG5vaXN5X2ltYWdlLCBkaXNrKDUpKSwgZGlzayg1KSkKb3BlbmluZyA9IG1pbmltdW0obWF4aW11bShub2lzeV9pbWFnZSwgZGlzayg1KSksIGRpc2soNSkpCmdyYWQgPSBncmFkaWVudChub2lzeV9pbWFnZSwgZGlzayg1KSkKCiMgZGlzcGxheSByZXN1bHRzCmZpZywgYXggPSBwbHQuc3VicGxvdHMoMiwgMiwgZmlnc2l6ZT1bMTAsIDddKQpheDEsIGF4MiwgYXgzLCBheDQgPSBheC5yYXZlbCgpCgpheDEuaW1zaG93KG5vaXN5X2ltYWdlLCBjbWFwPXBsdC5jbS5ncmF5KQpheDEuc2V0X3RpdGxlKCdPcmlnaW5hbCcpCmF4MS5heGlzKCdvZmYnKQoKYXgyLmltc2hvdyhjbG9zaW5nLCBjbWFwPXBsdC5jbS5ncmF5KQpheDIuc2V0X3RpdGxlKCdHcmF5LWxldmVsIGNsb3NpbmcnKQpheDIuYXhpcygnb2ZmJykKCmF4My5pbXNob3cob3BlbmluZywgY21hcD1wbHQuY20uZ3JheSkKYXgzLnNldF90aXRsZSgnR3JheS1sZXZlbCBvcGVuaW5nJykKYXgzLmF4aXMoJ29mZicpCgpheDQuaW1zaG93KGdyYWQsIGNtYXA9cGx0LmNtLmdyYXkpCmF4NC5zZXRfdGl0bGUoJ01vcnBob2xvZ2ljYWwgZ3JhZGllbnQnKQpheDQuYXhpcygnb2ZmJyk=</div><div class="tobehidden">CmZyb20gc2tpbWFnZSBpbXBvcnQgZGF0YQpmcm9tIHNraW1hZ2UuZmlsdGVyLnJhbmsgaW1wb3J0IGVudHJvcHkKZnJvbSBza2ltYWdlLm1vcnBob2xvZ3kgaW1wb3J0IGRpc2sKaW1wb3J0IG51bXB5IGFzIG5wCmltcG9ydCBtYXRwbG90bGliLnB5cGxvdCBhcyBwbHQKCmltYWdlID0gZGF0YS5jYW1lcmEoKQoKZmlnLCAoYXgxLCBheDIpID0gcGx0LnN1YnBsb3RzKDEsIDIsIGZpZ3NpemU9KDEwLCA0KSkKCmZpZy5jb2xvcmJhcihheDEuaW1zaG93KGltYWdlLCBjbWFwPXBsdC5jbS5ncmF5KSwgYXg9YXgxKQpheDEuc2V0X3RpdGxlKCdJbWFnZScpCmF4MS5heGlzKCdvZmYnKQoKZmlnLmNvbG9yYmFyKGF4Mi5pbXNob3coZW50cm9weShpbWFnZSwgZGlzayg1KSksIGNtYXA9cGx0LmNtLmpldCksIGF4PWF4MikKYXgyLnNldF90aXRsZSgnRW50cm9weScpCmF4Mi5heGlzKCdvZmYnKQ==</div><div class="tobehidden">CmZyb20gdGltZSBpbXBvcnQgdGltZQoKZnJvbSBzY2lweS5uZGltYWdlLmZpbHRlcnMgaW1wb3J0IHBlcmNlbnRpbGVfZmlsdGVyCmZyb20gc2tpbWFnZS5tb3JwaG9sb2d5IGltcG9ydCBkaWxhdGlvbgpmcm9tIHNraW1hZ2UuZmlsdGVyLnJhbmsgaW1wb3J0IG1lZGlhbiwgbWF4aW11bQoKCmRlZiBleGVjX2FuZF90aW1laXQoZnVuYyk6CiAgICAiIiJEZWNvcmF0b3IgdGhhdCByZXR1cm5zIGJvdGggZnVuY3Rpb24gcmVzdWx0cyBhbmQgZXhlY3V0aW9uIHRpbWUuIiIiCiAgICBkZWYgd3JhcHBlcigqYXJnKToKICAgICAgICB0MSA9IHRpbWUoKQogICAgICAgIHJlcyA9IGZ1bmMoKmFyZykKICAgICAgICB0MiA9IHRpbWUoKQogICAgICAgIG1zID0gKHQyIC0gdDEpICogMTAwMC4wCiAgICAgICAgcmV0dXJuIChyZXMsIG1zKQogICAgcmV0dXJuIHdyYXBwZXIKCgpAZXhlY19hbmRfdGltZWl0CmRlZiBjcl9tZWQoaW1hZ2UsIHNlbGVtKToKICAgIHJldHVybiBtZWRpYW4oaW1hZ2U9aW1hZ2UsIHNlbGVtPXNlbGVtKQoKCkBleGVjX2FuZF90aW1laXQKZGVmIGNyX21heChpbWFnZSwgc2VsZW0pOgogICAgcmV0dXJuIG1heGltdW0oaW1hZ2U9aW1hZ2UsIHNlbGVtPXNlbGVtKQoKCkBleGVjX2FuZF90aW1laXQKZGVmIGNtX2RpbChpbWFnZSwgc2VsZW0pOgogICAgcmV0dXJuIGRpbGF0aW9uKGltYWdlPWltYWdlLCBzZWxlbT1zZWxlbSkKCgpAZXhlY19hbmRfdGltZWl0CmRlZiBuZGlfbWVkKGltYWdlLCBuKToKICAgIHJldHVybiBwZXJjZW50aWxlX2ZpbHRlcihpbWFnZSwgNTAsIHNpemU9biAqIDIgLSAxKQ==</div><div class="tobehidden">CmEgPSBkYXRhLmNhbWVyYSgpCgpyZWMgPSBbXQplX3JhbmdlID0gcmFuZ2UoMSwgMjAsIDIpCmZvciByIGluIGVfcmFuZ2U6CiAgICBlbGVtID0gZGlzayhyICsgMSkKICAgIHJjLCBtc19yYyA9IGNyX21heChhLCBlbGVtKQogICAgcmNtLCBtc19yY20gPSBjbV9kaWwoYSwgZWxlbSkKICAgIHJlYy5hcHBlbmQoKG1zX3JjLCBtc19yY20pKQoKcmVjID0gbnAuYXNhcnJheShyZWMpCgpmaWcsIGF4ID0gcGx0LnN1YnBsb3RzKCkKYXguc2V0X3RpdGxlKCdQZXJmb3JtYW5jZSB3aXRoIHJlc3BlY3QgdG8gZWxlbWVudCBzaXplJykKYXguc2V0X3lsYWJlbCgnVGltZSAobXMpJykKYXguc2V0X3hsYWJlbCgnRWxlbWVudCByYWRpdXMnKQpheC5wbG90KGVfcmFuZ2UsIHJlYykKYXgubGVnZW5kKFsnZmlsdGVyLnJhbmsubWF4aW11bScsICdtb3JwaG9sb2d5LmRpbGF0ZSddKQ==</div><div class="tobehidden">CnIgPSA5CmVsZW0gPSBkaXNrKHIgKyAxKQoKcmVjID0gW10Kc19yYW5nZSA9IHJhbmdlKDEwMCwgMTAwMCwgMTAwKQpmb3IgcyBpbiBzX3JhbmdlOgogICAgYSA9IChucC5yYW5kb20ucmFuZG9tKChzLCBzKSkgKiAyNTYpLmFzdHlwZShucC51aW50OCkKICAgIChyYywgbXNfcmMpID0gY3JfbWF4KGEsIGVsZW0pCiAgICAocmNtLCBtc19yY20pID0gY21fZGlsKGEsIGVsZW0pCiAgICByZWMuYXBwZW5kKChtc19yYywgbXNfcmNtKSkKCnJlYyA9IG5wLmFzYXJyYXkocmVjKQoKZmlnLCBheCA9IHBsdC5zdWJwbG90cygpCmF4LnNldF90aXRsZSgnUGVyZm9ybWFuY2Ugd2l0aCByZXNwZWN0IHRvIGltYWdlIHNpemUnKQpheC5zZXRfeWxhYmVsKCdUaW1lIChtcyknKQpheC5zZXRfeGxhYmVsKCdJbWFnZSBzaXplJykKYXgucGxvdChzX3JhbmdlLCByZWMpCmF4LmxlZ2VuZChbJ2ZpbHRlci5yYW5rLm1heGltdW0nLCAnbW9ycGhvbG9neS5kaWxhdGUnXSk=</div><div class="tobehidden">CmEgPSBkYXRhLmNhbWVyYSgpCgpyZWMgPSBbXQplX3JhbmdlID0gcmFuZ2UoMiwgMzAsIDQpCmZvciByIGluIGVfcmFuZ2U6CiAgICBlbGVtID0gZGlzayhyICsgMSkKICAgIHJjLCBtc19yYyA9IGNyX21lZChhLCBlbGVtKQogICAgcm5kaSwgbXNfbmRpID0gbmRpX21lZChhLCByKQogICAgcmVjLmFwcGVuZCgobXNfcmMsIG1zX25kaSkpCgpyZWMgPSBucC5hc2FycmF5KHJlYykKCmZpZywgYXggPSBwbHQuc3VicGxvdHMoKQpheC5zZXRfdGl0bGUoJ1BlcmZvcm1hbmNlIHdpdGggcmVzcGVjdCB0byBlbGVtZW50IHNpemUnKQpheC5wbG90KGVfcmFuZ2UsIHJlYykKYXgubGVnZW5kKFsnZmlsdGVyLnJhbmsubWVkaWFuJywgJ3NjaXB5Lm5kaW1hZ2UucGVyY2VudGlsZSddKQpheC5zZXRfeWxhYmVsKCdUaW1lIChtcyknKQpheC5zZXRfeGxhYmVsKCdFbGVtZW50IHJhZGl1cycp</div><div class="tobehidden">CmZpZywgYXggPSBwbHQuc3VicGxvdHMoKQpheC5pbXNob3cobnAuaHN0YWNrKChyYywgcm5kaSkpKQpheC5zZXRfdGl0bGUoJ2ZpbHRlci5yYW5rLm1lZGlhbiB2cy4gc2NpcHkubmRpbWFnZS5wZXJjZW50aWxlJykKYXguYXhpcygnb2ZmJyk=</div><div class="tobehidden">CnIgPSA5CmVsZW0gPSBkaXNrKHIgKyAxKQoKcmVjID0gW10Kc19yYW5nZSA9IFsxMDAsIDIwMCwgNTAwLCAxMDAwXQpmb3IgcyBpbiBzX3JhbmdlOgogICAgYSA9IChucC5yYW5kb20ucmFuZG9tKChzLCBzKSkgKiAyNTYpLmFzdHlwZShucC51aW50OCkKICAgIChyYywgbXNfcmMpID0gY3JfbWVkKGEsIGVsZW0pCiAgICBybmRpLCBtc19uZGkgPSBuZGlfbWVkKGEsIHIpCiAgICByZWMuYXBwZW5kKChtc19yYywgbXNfbmRpKSkKCnJlYyA9IG5wLmFzYXJyYXkocmVjKQoKZmlnLCBheCA9IHBsdC5zdWJwbG90cygpCmF4LnNldF90aXRsZSgnUGVyZm9ybWFuY2Ugd2l0aCByZXNwZWN0IHRvIGltYWdlIHNpemUnKQpheC5wbG90KHNfcmFuZ2UsIHJlYykKYXgubGVnZW5kKFsnZmlsdGVyLnJhbmsubWVkaWFuJywgJ3NjaXB5Lm5kaW1hZ2UucGVyY2VudGlsZSddKQpheC5zZXRfeWxhYmVsKCdUaW1lIChtcyknKQpheC5zZXRfeGxhYmVsKCdJbWFnZSBzaXplJyk=</div><div class="tobehidden">CnBsdC5zaG93KCk=</div></div>
</div>


        </div>
        <div class="span3"><h4 class="sidebar-box-heading">Navigation</h4>
<div class="well sidebar-box">
    <ul class="nav nav-list">
        <li><a href="../../index.html">Documentation Home</a></li>
    </ul>
</div>
        <h4 class="sidebar-box-heading">Contents</h4>
        <div class="well sidebar-box toc">
            <ul class="nav nav-list">
<li><a class="reference internal" href="#">Rank filters</a><ul class="nav nav-list">
<li><a class="reference internal" href="#noise-removal">Noise removal</a></li>
<li><a class="reference internal" href="#image-smoothing">Image smoothing</a></li>
<li><a class="reference internal" href="#contrast-enhancement">Contrast enhancement</a></li>
<li><a class="reference internal" href="#image-threshold">Image threshold</a></li>
<li><a class="reference internal" href="#image-morphology">Image morphology</a></li>
<li><a class="reference internal" href="#feature-extraction">Feature extraction</a></li>
<li><a class="reference internal" href="#implementation">Implementation</a></li>
</ul>
</li>
</ul>

        </div>

<h4 class="sidebar-box-heading">Versions</h4>
<div class="well sidebar-box">
    <ul class="nav nav-list">
        <script src="../../_static/docversions.js"></script>
        <script type="text/javascript">
            insert_version_links();
        </script>
    </ul>
</div>
        </div>
    </div>
    <div class="well footer">
        <small>
            &copy; Copyright the scikit-image development team.
            Created using <a href="http://twitter.github.com/bootstrap/">Bootstrap</a> and <a href="http://sphinx.pocoo.org/">Sphinx</a>.
        </small>
    </div>
</body>
</html>