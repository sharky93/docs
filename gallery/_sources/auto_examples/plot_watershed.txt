.. _example_plot_watershed.py:


======================
Watershed segmentation
======================

The watershed is a classical algorithm used for **segmentation**, that
is, for separating different objects in an image.

Starting from user-defined markers, the watershed algorithm treats
pixels values as a local topography (elevation). The algorithm floods
basins from the markers, until basins attributed to different markers
meet on watershed lines.  In many cases, markers are chosen as local
minima of the image, from which basins are flooded.

In the example below, two overlapping circles are to be separated. To
do so, one computes an image that is the distance to the
background. The maxima of this distance (i.e., the minima of the
opposite of the distance) are chosen as markers, and the flooding of
basins from such markers separates the two circles along a watershed
line.

See Wikipedia_ for more details on the algorithm.

.. _Wikipedia: http://en.wikipedia.org/wiki/Watershed_(image_processing)


.. image:: images/plot_watershed_1.png
    :align: center


.. raw:: html
    
    <p id="controls">
        <button type="button" class="btn btn-default btn-small" id="editcode">
            <i class="icon-edit"></i>
        </button>
    </p>

.. literalinclude:: plot_watershed.py
    :lines: 27-


.. raw:: html

    <p id="run_btn">
        <button type="button" class="btn btn-default btn-lg" id="runcode">
            <i class="icon-play"></i> Run
        </button>
        <button type="button" class="btn btn-default btn-lg" id="reload">
            <i class="icon-refresh"></i>
        </button>
        <img id="loading" src="../_static/ajax-loader.gif"/>
    </p>

.. raw:: html

    <p>
        <div class="alert alert-success" id="success-message"></div>
        <div class="alert alert-error" id="error-message"></div>
        <div class="all-output">
            <p class="stdout-group">
                <i class="icon-info-sign"></i> <u>STDOUT</u>
            </p>
            <pre id="stdout"></pre>
            <hr class="stdout-group">
            <p class="stderr-group">
                <i class="icon-remove-sign"></i> <u>STDERR</u>
            </p>
            <pre id="stderr"></pre>
            <hr class="stderr-group">
        </div>
    </p>


**Python source code:** :download:`download <plot_watershed.py>`
(generated using ``skimage`` |version|)



**IPython Notebook:** :download:`download <./notebook/plot_watershed.ipynb>`
(generated using ``skimage`` |version|)


.. raw:: html

    <div class="tobehidden">aW1wb3J0IG51bXB5IGFzIG5wCmltcG9ydCBtYXRwbG90bGliLnB5cGxvdCBhcyBwbHQKZnJvbSBzY2lweSBpbXBvcnQgbmRpbWFnZQoKZnJvbSBza2ltYWdlLm1vcnBob2xvZ3kgaW1wb3J0IHdhdGVyc2hlZApmcm9tIHNraW1hZ2UuZmVhdHVyZSBpbXBvcnQgcGVha19sb2NhbF9tYXgKCgojIEdlbmVyYXRlIGFuIGluaXRpYWwgaW1hZ2Ugd2l0aCB0d28gb3ZlcmxhcHBpbmcgY2lyY2xlcwp4LCB5ID0gbnAuaW5kaWNlcygoODAsIDgwKSkKeDEsIHkxLCB4MiwgeTIgPSAyOCwgMjgsIDQ0LCA1MgpyMSwgcjIgPSAxNiwgMjAKbWFza19jaXJjbGUxID0gKHggLSB4MSkqKjIgKyAoeSAtIHkxKSoqMiA8IHIxKioyCm1hc2tfY2lyY2xlMiA9ICh4IC0geDIpKioyICsgKHkgLSB5MikqKjIgPCByMioqMgppbWFnZSA9IG5wLmxvZ2ljYWxfb3IobWFza19jaXJjbGUxLCBtYXNrX2NpcmNsZTIpCgojIE5vdyB3ZSB3YW50IHRvIHNlcGFyYXRlIHRoZSB0d28gb2JqZWN0cyBpbiBpbWFnZQojIEdlbmVyYXRlIHRoZSBtYXJrZXJzIGFzIGxvY2FsIG1heGltYSBvZiB0aGUgZGlzdGFuY2UgdG8gdGhlIGJhY2tncm91bmQKZGlzdGFuY2UgPSBuZGltYWdlLmRpc3RhbmNlX3RyYW5zZm9ybV9lZHQoaW1hZ2UpCmxvY2FsX21heGkgPSBwZWFrX2xvY2FsX21heChkaXN0YW5jZSwgaW5kaWNlcz1GYWxzZSwgZm9vdHByaW50PW5wLm9uZXMoKDMsIDMpKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVscz1pbWFnZSkKbWFya2VycyA9IG5kaW1hZ2UubGFiZWwobG9jYWxfbWF4aSlbMF0KbGFiZWxzID0gd2F0ZXJzaGVkKC1kaXN0YW5jZSwgbWFya2VycywgbWFzaz1pbWFnZSkKCmZpZywgYXhlcyA9IHBsdC5zdWJwbG90cyhuY29scz0zLCBmaWdzaXplPSg4LCAyLjcpKQpheDAsIGF4MSwgYXgyID0gYXhlcwoKYXgwLmltc2hvdyhpbWFnZSwgY21hcD1wbHQuY20uZ3JheSwgaW50ZXJwb2xhdGlvbj0nbmVhcmVzdCcpCmF4MC5zZXRfdGl0bGUoJ092ZXJsYXBwaW5nIG9iamVjdHMnKQpheDEuaW1zaG93KC1kaXN0YW5jZSwgY21hcD1wbHQuY20uamV0LCBpbnRlcnBvbGF0aW9uPSduZWFyZXN0JykKYXgxLnNldF90aXRsZSgnRGlzdGFuY2VzJykKYXgyLmltc2hvdyhsYWJlbHMsIGNtYXA9cGx0LmNtLnNwZWN0cmFsLCBpbnRlcnBvbGF0aW9uPSduZWFyZXN0JykKYXgyLnNldF90aXRsZSgnU2VwYXJhdGVkIG9iamVjdHMnKQoKZm9yIGF4IGluIGF4ZXM6CiAgICBheC5heGlzKCdvZmYnKQoKZmlnLnN1YnBsb3RzX2FkanVzdChoc3BhY2U9MC4wMSwgd3NwYWNlPTAuMDEsIHRvcD0xLCBib3R0b209MCwgbGVmdD0wLAogICAgICAgICAgICAgICAgICAgIHJpZ2h0PTEpCnBsdC5zaG93KCk=</div>
